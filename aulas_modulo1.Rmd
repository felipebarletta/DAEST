---
title: "Comandos das aulas do curso"
output:
  html_document:
    toc: false
    code_folding: show
---

```{r setup, include=FALSE, cache=FALSE}
#source("setup_knitr.R")
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      warning = FALSE,
                      message = FALSE)
```


```{css, echo=FALSE}
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
.toc-content {
padding-left: 0;
padding-right: 0;
margin-left: -95px;
}
table.dataTable thead th {
text-align: left;
}
table.dataTable tbody th, table.dataTable tbody td {
padding: 8px 18px;
}
table.dataTable thead th, table.dataTable thead td {
padding: 8px 18px 8px 18px;
border-bottom: 1px solid #111;
}
body {
font-family: Roboto;
font-size: 14px;
line-height: 1.529;
}
h1.title {
padding-top: 30px;
top: 34px;
left: 390px;
width: 832px;
height: 77px;
text-align: left;
letter-spacing: 1px;
color: #000000;
opacity: 1;
margin: 0;
font-size: 30px;
line-height: 47px;
font-family: 'Roboto', sans-serif;
display: inline-block;
max-width: 100%;
}
h4.date {
font-family: "Roboto Mono", Roboto, sans-serif;
font-size: 20px;
color: #000000;
line-height: 26px;
font-weight: 400;
letter-spacing: 0;
}
body::before {
content: '';
height: 168px;
width: 100%;
position: absolute;
top: 0;
left: 0;
background: #FFFAFA;
z-index: -1;
}

@media only screen and (min-width: 1600px) {
#header {
background: url(http://www.utfpr.edu.br/icones/cabecalho/logo-utfpr/@@images/image.png) #FFFAFA right center no-repeat padding-box;
background-size: 210px;
}
```
<br>
<br>
<br>

Abaixo estão os comandos do `R` utilizados durante as aulas.


## Módulo 1 - Probabilidade

- **Aula 01** - $01/09/2020$:

## Primiro exemplo

```{R}
x <- c(1,2,3,4,5,6,7,80)
x
class(x)
x[8]
X <- matrix(data= c(1,2,3,4),ncol = 2, byrow=TRUE)
X
Y <- matrix(c(2,4,5,8,6,8),ncol=2, byrow = TRUE)
Y
Y%*%X
Y[1,2]
```
### Funções estatística básica
```{r est_basica}
x <- rnorm(100)
head(x,n=3)
tail(x,n=3)

#### Media = somatório x_i/n
media <- function(x){
    soma = 0
    for(i in 1:length(x))
        soma = soma + x[i]
    media = soma/length(x)
    return(media)
}
media(x)

mean(x)
```

#### Intervalo de confiança
```{r IC}
# LI = media - Z*desvio_padrão/raiz(n)
# LS = media + Z*desvio_padrão/raiz(n)
IC <- function(x, conf = 0.95){
    avg = media(x)
    z = c(-qnorm(conf),qnorm(conf))
    dp = sd(x)
    n = length(x)
    raizn <- sqrt(n)
    #li = avg - z*(dp/raizn)
    #ls = avg + z*(dp/raizn)
    ic  <- avg + z*(dp/raizn)
    return(paste("IC(95%)= (",  round(ic[1],2),";",round(ic[2],2),")"))
}
IC(x)
```

#### Exemplo de acesso a dados
```{R dados}
### Listando arquivos
dir(pattern = '.csv')

dados <- read.csv("hospital.csv",
                  header = TRUE, sep ='\t')
head(dados)
dim(dados)
str(dados)
```

### Sumário dos dados
```{r summary}
media(dados$idade)
names(dados)
var_num <- dados[,c(1,3:8)]
str(var_num)

summary(dados$idade)

for(i in 1:length(names(var_num))){
    print(summary(var_num[i]))
    }
```

## Gráficos
```{r graph, results='hide'}
plot(var_num$idade)
hist(var_num$idade)

par(mfrow=c(2,4))
lapply(var_num,hist)

```

#### ggplot2
### lattice
```{R,ggplot}
library(ggplot2)

var_num$id <- 1:dim(var_num)[1]
df <- reshape2::melt(var_num, id.vars = 'id', variable.name = "serie")
ggplot(df, aes(id,value)) +
    geom_line(aes(colour = serie)) +
    facet_grid(serie ~ .)
```

##### Probabilidade
#### Exemplo de espaço amostra
```{R omega1}
## Lançamento de dois dados
6^2
amostral <- 1:6
amostral

n <- 3000
sorteio <- NULL
for(i in 1:n)
    sorteio <- c(sorteio,paste(sample(x = amostral,
                                      replace = TRUE,
                                size = 2),collapse =""))

length(unique(sorteio))
sorteio <- sort(unique(sorteio))
sorteio

## Lançamento de três dados
6^3
n <- 3000
sorteio2 <- NULL
for(i in 1:n)
    sorteio2 <- c(sorteio2,paste(sample(x = amostral,
                                      replace = TRUE,
                                size = 3),collapse =""))

length(unique(sorteio2))
sorteio2 <- sort(unique(sorteio2))
sorteio2
```

### Exemplo definição clássica de probab.
```{R defClass}
### E1= (1,1)
library(prob)


#a <- urnsamples(amostral,
#           size = 2,
#           replace = TRUE)

amostral
sorteio2
dado1 <- substr(sorteio,1,1)
dado2 <- substr(sorteio,2,2)
iguais <- ifelse(dado1 == dado2, sorteio,"excluir")
iguais
iguais <- iguais[iguais != "excluir"]
PE1 <- length(iguais)/length(sorteio)
PE1

```


- **Aula 02** - $15/09/2020$:

## União e intersecção

```{R conjunto}
## Espaço amostral= (1,2,3,4,5,6)
A <- 1:4
B <- 1:3
C <- c(2,4,6)
D <- c(2,3,5)

                                        # Função União
uniao <- function(a,b){
    u = a
    for(i in 1:length(b))
        if(!b[i] %in% u){
            u = c(u,b[i])
        }
        return(u)
    }

uniao(A,B)
uniao(A,C)

union(A,C)

                                        # Função para intersecção

Inter <- function(a,b){
    inte <- NULL
    for(i in 1:length(a))
        if(a[i] %in% b){
            inte  <- c(inte, a[i])
        }
    return(inte)
    }
Inter(a=A, b=B)
Inter(A,D)

intersect(A,D)

amostral <- 1:6
A
```


## Regra da Adição

```{R regra}
rm(list=ls())
dados <- read.csv("hospital.csv",
                  header = T,
                  sep = '\t')
head(dados)
##P(AuB) = P(A) + P(B) - P(AinterB)
## Criando variável dicotomica para Temperatura
dados$Temp_nivel <- ifelse(dados$temperatura <=35 |
                           dados$temperatura >=38.4,
                           "Alterada",
                           "Nao_Alterada")

## Criando variável dicotomica para Temperatura
dados$Resp_nivel <- ifelse(dados$freq_respiratoria <=14,
                           "Alterada",
                           "Nao_Alterada")
table(dados$Temp_nivel)
table(dados$Resp_nivel)
# A: Temperatura nao alterada
# B: Respiração não alterada
PA <- table(dados$Temp_nivel)[2]/nrow(dados)
PA

PB <- table(dados$Resp_nivel)[2]/nrow(dados)
PB

table(dados$Temp_nivel,dados$Resp_nivel)
PAinterB <- 3910/nrow(dados)
PAinterB
PAuB <- PA + PB - PAinterB
PAuB
PA+(1-PA)

```

## Probabilidade condicional
```{R AdadoB}
library(ggplot2)
ggplot(dados, aes(idade, fill = alta.motivo, colour = alta.motivo)) +
    geom_density(alpha= 0.1, fill = 'white')

### Probabilidade de óbito
table(dados$alta.motivo)
PO <- table(dados$alta.motivo)[2]/nrow(dados)
PO
### P(O | idade >= 55) = P(O inter idade >=55)/P(idade >=55)
dados$f_idade <- ifelse(dados$idade < 55,
                        "F1",
                        "F2")
table(dados$f_idade)
PF2 <- table(dados$f_idade)[2]/nrow(dados)
PF2
table(dados$f_idade,dados$alta.motivo)
POinterF2 <- 330/nrow(dados)
POinterF2
POdadoF2 <- POinterF2/PF2
POdadoF2
```


## Regra do produto Independência de eventos
```{R Prod_Ind}
table(dados$Temp_nivel,dados$Resp_nivel)

##P(AinterB) = P(A)*P(B)
PAPB <- PA*PB
PAPB
PAdadoB <- PAinterB/PB
PAdadoB
```

## Partição do espaço amostral

```{R UTI}
library(dplyr)

UTI <- dados %>%
    filter(setor %in% c('UTIG',
                        'UTIC',
                        'UTIP'))

UTI$setor <- droplevels(UTI$setor)
table(UTI$setor)

#PA1 = P(O inter UTIG)  = P(O | UTIG)*P(UTIG)
POuti <- table(UTI$alta.motivo)[2]/nrow(UTI)
PUTIG <- table(UTI$setor)[2]/nrow(UTI)
PUTIG*POuti
table(UTI$alta.motivo,UTI$setor)
171/nrow(UTI)


PA1 <- table(UTI$setor,UTI$alta.motivo)[5]/nrow(UTI)
PA2 <- table(UTI$setor,UTI$alta.motivo)[6]/nrow(UTI)
PA3 <- table(UTI$setor,UTI$alta.motivo)[4]/nrow(UTI)
PA1
PA2
PA3
# PA1 U PA2 U PA3
# TMA DA PROBABILIDADE TOTAL
PoUTI  <- PA1+PA2+PA3
PoUTI
                                        #P(O | UTIG) = PA1/PUTIG
PA1 / (174/nrow(UTI))

```

```{R condicional}
# P(UTIP inter O) = P (O | UTIP) * P(O)
PUTIP <- length(UTI$setor[UTI$setor == 'UTIP'])/nrow(UTI)
PUTIP
PUTIPdadoO <- PA2/PUTIP
PUTIPdadoO

# P(UTIC inter O) = P (O | UTIC) * P(O)
PUTIC <- length(UTI$setor[UTI$setor == 'UTIC'])/nrow(UTI)
PUTIC
PUTICdadoO <- PA3/PUTIC
PUTICdadoO


# P(UTIG inter O) = P (O | UTIG) * P(O)
PUTIG <- length(UTI$setor[UTI$setor == 'UTIG'])/nrow(UTI)
PUTIG
PUTIGdadoO <- PA1/PUTIG
PUTIGdadoO


```


## TMA BAYES

```{R bayes}
## P(UTIG | O) = P(O | UTIG) * P(UTIG)/(PoUTI)
PUTIGdadoO <- PA1/PoUTI
PUTIGdadoO
```


## Função de probabilidade (f.p.)
```{R fp}
X <- 0:6
X
fo <- c(9,14,13,9,4,2,1)
fo
fr <- fo/52
df <- data.frame(X,fo,fr)
df
#Gráfico p(x)
p1 <- ifelse(df$fr > 1 | df$fr< 0,
             'N_p(x)','p(x)')
table(p1)

#p2
sum(df$fr)



#P(X = 2)
# P(X>2) = P(X =3 U X=4 U X=5 U X=6) = P(X=3)+P(X=4)+P(X=5)+P(X=6)
df$Fx <- cumsum(df$fr)
df

# 1 - P(X<=2)
1-0.692307

par(mfrow=c(1,2))
plot(df$X,
     df$fr,
     xlab='V.A.',
     ylab = 'P[X=x]',
     type = 'h')

plot(df$X,
     df$Fx,
     xlab = 'V.A.',
     ylab = 'F(x)= P[X<=x]',
     type = 's')

```
