---
title: "Módulo 3"
output:
  html_document:
    toc: false
    code_folding: show
---

```{r setup, include=FALSE, cache=FALSE}
#source("setup_knitr.R")
knitr::opts_chunk$set(echo = TRUE,
                      comment = NA,
                      warning = FALSE,
                      message = FALSE)
```

# Correlação (27/10/20)

## Simulação de exemplos de possíveis correlações


```{r}
# Diagrama de dispersão
# Plotando todos no mesmo gráfico
par(mfrow=c(2,3))
# Correlação perfeita positiva
x<-seq(-100, 100)
y1<-x*2.53
plot(x, y1, main = "Correlação perfeita positiva",ylab = "y",col="blue")

# Correlação perfeita negativa
x<-seq(-100, 100)
y2<- -x*2.53
plot(x, y2, main = "Correlação perfeita positiva",ylab = "y",col="blue")

# Alta correlação positiva
y3<-rnorm(y1,y1,20)
plot(x,y3,main="Alta correlação positiva",ylab = "y",col="blue")

# Alta correlação
y4<-rnorm(y1,(-1)*y1,20)
plot(x,y4,main="Alta correlação negativa",ylab = "y",col="blue")

# Baixa correlação positiva
y5<-rnorm(y1,y1,500)
plot(x,y5,main="Baixa correlação",ylab = "y",col="blue")

# Correlação não linear
y6<- rnorm(x, x^2, 1000)
plot(x,y6,main="Correlação não linear",ylab = "y",col="blue")

```

## Exercício 1

```{r}
distancia<-scan(text="20.00 60.00 15.00 45.00 35.00 80.00 70.00 73.00 28.00 85.00")
consumo<-scan(text=" 1.33 5.45 1.66 3.46 2.92 6.15 4.11 5.00 2.95 6.54")

#Cálculo da correlação linear simples
xbarra<-mean(distancia)
ybarra<-mean(consumo)
sumxy<-sum(distancia*consumo)
sumx2<-sum(distancia^2)
sumy2<-sum(consumo^2)
n<-length(consumo)
r<-(sumxy-n*xbarra*ybarra) / (sqrt((sumx2-n*(xbarra^2))*(sumy2-n*(ybarra^2))))
r
r^2

```

```{r}
# Crianção da função para a correlação e coeficiente de determinação
correlacao<-function(x,y){
  sumxy<-sum(x*y)
  xbarra<-mean(x)
  ybarra<-mean(y)
  sumx2<-sum(x^2)
  sumy2<-sum(y^2)
  n<-length(x)
  r<-(sumxy-n*xbarra*ybarra) / (sqrt((sumx2-n*(xbarra^2))*(sumy2-n*(ybarra^2))))
  r2<-r^2
  return(list(coef.correlacao=r,coef.determinacao=r2))
}
correlacao(distancia,consumo)

```


```{r}
# Função disponível no R
cor(consumo,distancia)

```


```{r}
# Diagrama de dispersão x= Distância y= Consumo
plot(distancia, consumo, main="Consumo x Distância", ylab= "Consumo (l)", xlab="Distância (km)",
     pch=16, col="blue",cex.main=1.5, cex=1.5,cex.lab=1.2, cex.axis=1,bty="l")
abline(h=seq(0,7,1), v=seq(0,90, 10), lty=3, col="gray")
text(30,5, "r=-0.95 ",col = "red",cex = 1.2)
text(30,4.5, "r2=0.90",col = "red",cex = 1.2)

```

```{r}
# Criação da função do teste
test.c<-function(r,n){
  t<-r*sqrt((n-2)/(1-r^2))
  return(t)
}

```


```{r}
# Usando a função com o valor de r arredondado
r<-0.95
n<-10
test.c(r,n)
alpha<-0.05
qt(alpha/2, df = n-2)
qt(1-(alpha/2), df = n-2)

```


```{r}
#Fazendo o teste (t.calc>t.crit)
test.c(r,n) > qt(alpha/2, df = n-2) | test.c(r,n) < qt(1-(alpha/2), df = n-2) 
# Não aceita H0. Há correlação, com 95% de confiança.

```




```{r}
#Usando a função disponível no R
cor.test(distancia,consumo)

```


```{r}
# Acréscimo na função anterior - opção 1
correlacao<-function(x,y){
  sumxy<-sum(x*y)
  xbarra<-mean(x)
  ybarra<-mean(y)
  sumx2<-sum(x^2)
  sumy2<-sum(y^2)
  n<-length(x)
  r<-(sumxy-n*xbarra*ybarra) / (sqrt((sumx2-n*(xbarra^2))*(sumy2-n*(ybarra^2))))
  r2<-r^2
  t<-r*sqrt((n-2)/(1-r^2))
  return(list(coef.correlacao=r,coef.determinacao=r2, teste.calc=t))
}
correlacao(distancia,consumo)

```


```{r}
# Usando a função sem arredondamento - opção 2
r<-cor(distancia,consumo)
n<-10
test.c(r,n)

```


## Gráfico para duas variáveis no eixo y


```{r}
# Construção do gráfico das variáveis com dois diferentes eixos y
#dev.off() # Limpa padrão gráfico
x<-1:10 # Eixo x
par(mar=c(5.1, 4.1, 4.1, 6.1)) # Estipula as margens para plotar o gráfico

## Primeiro eixo: Consumo
plot(x, consumo, pch=16, axes=FALSE, xlab="", ylab="", 
     type="b",col="black", main="Consumo x Distância")
# Eixo para a variável consumo
axis(2, ylim=c(0,max(consumo)),col="black") 
mtext("Consumo",side=2,line=2,col="black")
## Permitir uma nova figura no mesmo gráfico
par(new=TRUE)

## Segundo eixe: Distância
plot(x,distancia, pch=15,  xlab="", ylab="", 
     axes=FALSE, type="b", col="red")
# Eixo para a variável consumo
axis(4, ylim=c(0,max(distancia)),col="red",col.axis="red") 
mtext("Distância",side=4,line=2,col="red")

## Eixo x
axis(1,1:10)
mtext("Amostra",side=1,col="black",line=2)  

## Adicionando a legenda
legend("topleft",legend=c("Consumo","Distância"),
       text.col=c("black","red"),pch=c(16,15),col=c("black","red"))

```
